// src/app/modules/credentials/credentials.component.scss
:host {
    display: block;
}
.cred-page {
    animation: fadeIn 0.4s ease-out;
}
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(8px);
    }
    to {
        opacity: 1;
    }
}

// ── Header ────────────────────────────────────────────────────────────────────
.page-header {
    margin-bottom: 1.5rem;
}
.page-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--surface-900);
    margin: 0 0 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    i {
        color: var(--primary-color);
    }
}
.page-subtitle {
    color: var(--text-color-secondary);
    margin: 0;
    font-size: 0.9rem;
}

// ── Layout ────────────────────────────────────────────────────────────────────
.cred-layout {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 1.25rem;
    align-items: start;
}

// ── Search Panel ──────────────────────────────────────────────────────────────
.search-panel {
    background: var(--surface-card);
    border-radius: 0.75rem;
    box-shadow: var(--card-shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    position: sticky;
    top: 1rem;
}
.search-panel-header {
    padding: 0.85rem 1rem;
    background: var(--surface-50);
    border-bottom: 1px solid var(--surface-200);
}
.panel-label {
    font-size: 0.68rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-color-secondary);
}

::ng-deep .type-select .p-selectbutton {
    width: 100%;
}
::ng-deep .type-select .p-button {
    flex: 1;
    font-size: 0.78rem;
}

.search-input-wrap {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--surface-200);
    i {
        color: var(--text-color-secondary);
        font-size: 0.85rem;
    }
    input {
        border: none;
        outline: none;
        background: transparent;
        flex: 1;
        font-size: 0.875rem;
        color: var(--surface-900);
        &::placeholder {
            color: var(--text-color-secondary);
        }
    }
}
// Ajuste padding para p-selectButton y search-input dentro del panel
.search-panel {
    padding: 0;
}
.search-panel-header ~ p-selectButton,
.search-panel > p-selectButton {
    padding: 0.75rem 1rem 0;
}

.search-results {
    overflow-y: auto;
    max-height: 520px;
}

.result-skeleton {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.65rem 1rem;
    border-bottom: 1px solid var(--surface-100);
}
.skel-lines {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.empty-search {
    text-align: center;
    padding: 2.5rem 1rem;
    color: var(--text-color-secondary);
    i {
        font-size: 2rem;
        display: block;
        margin-bottom: 0.5rem;
        color: var(--surface-300);
    }
    p {
        margin: 0;
        font-size: 0.85rem;
    }
}

.result-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.65rem 1rem;
    border-bottom: 1px solid var(--surface-100);
    cursor: pointer;
    transition: background 0.15s;
    &:hover {
        background: var(--surface-50);
    }
    &.selected {
        background: rgba(99, 102, 241, 0.06);
        border-left: 3px solid var(--primary-color);
    }
}
.result-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    flex-shrink: 0;
    overflow: hidden;
    background: var(--primary-100, #e0e7ff);
    display: flex;
    align-items: center;
    justify-content: center;
    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    span {
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--primary-700, #3730a3);
    }
}
.result-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.05rem;
    min-width: 0;
}
.result-name {
    font-size: 0.82rem;
    font-weight: 700;
    color: var(--surface-900);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.result-label {
    font-size: 0.68rem;
    color: var(--text-color-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.result-badges {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.25rem;
    flex-shrink: 0;
}
.result-has-cred {
    color: #22c55e;
    font-size: 0.85rem;
}
.result-no-cred {
    color: var(--surface-400);
    font-size: 0.85rem;
}

// ── Preview Panel ─────────────────────────────────────────────────────────────
.preview-panel {
    background: var(--surface-card);
    border-radius: 0.75rem;
    box-shadow: var(--card-shadow);
    padding: 1.5rem;
    min-height: 500px;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.empty-preview {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    color: var(--text-color-secondary);
    i {
        font-size: 3.5rem;
        color: var(--surface-300);
    }
    h3 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--surface-700);
    }
    p {
        margin: 0;
        font-size: 0.875rem;
        text-align: center;
        max-width: 280px;
    }
}

.person-info-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding-bottom: 1.25rem;
    border-bottom: 1px solid var(--surface-200);
    flex-wrap: wrap;
}
.person-info-left {
    display: flex;
    align-items: center;
    gap: 1rem;
}
.person-avatar-lg {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    flex-shrink: 0;
    overflow: hidden;
    background: var(--primary-100, #e0e7ff);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid var(--primary-200, #c7d2fe);
    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    span {
        font-size: 1rem;
        font-weight: 800;
        color: var(--primary-700, #3730a3);
    }
}
.person-name {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--surface-900);
    margin: 0 0 0.15rem;
}
.person-label {
    font-size: 0.82rem;
    color: var(--text-color-secondary);
    margin: 0 0 0.1rem;
}
.person-issued {
    font-size: 0.72rem;
    color: var(--text-color-secondary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    i {
        font-size: 0.65rem;
    }
}
.person-info-actions {
    display: flex;
    gap: 0.65rem;
}

.loading-cred {
    display: flex;
    justify-content: center;
    padding: 1rem 0;
}

// ── Credential Preview Wrap ───────────────────────────────────────────────────
.credential-preview-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}
.preview-label {
    font-size: 0.72rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-color-secondary);
    align-self: flex-start;
}

// ══════════════════════════════════════════════════════════════════════════════
// CARNET — usa assets/img/Credenciales.png como fondo
// Todos los elementos están posicionados en % sobre la imagen base.
// Para cambiar el diseño visual: reemplazar el PNG.
// Las posiciones de los datos NO cambian.
//
// Preview en pantalla: 430×273px  (ratio 1.5737 = original)
// Impresión real:      8.6cm×5.4cm
// ══════════════════════════════════════════════════════════════════════════════
.credential-card {
    position: relative;
    width: 430px;
    height: 273px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    flex-shrink: 0;

    // El PNG es la base visual completa
    background-image: url('/assets/img/Credenciales.png');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    font-family: 'Arial', sans-serif;
}

// ── Foto circular ─────────────────────────────────────────────────────────────
// Posición medida del PNG: left=4.98%, top=13.79%, diámetro=28.39% del ancho
.cred-photo-circle {
    position: absolute;
    left: 4.98%;
    top: 7.56%; // 8.29% - (2px/273px*100)
    width: 28.86%; // 28.39% + (2px/430px*100)
    aspect-ratio: 1;
    border-radius: 50%;
    overflow: hidden;
    // Sin borde propio: el borde celeste ya está en el PNG
    background: rgba(0, 27, 64, 0.15);

    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }
    .cred-initials {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 900;
        color: #0a4f94;
    }
}

// ── Nombre institución (topbar, alineado a la derecha) ─────────────────────
.cred-institution {
    position: absolute;
    top: 0;
    left: 35%; // 5px después del borde derecho de la foto
    right: 0.7%; // 3px del borde lateral derecho
    height: 13.79%;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    font-size: 12px;
    font-weight: 700;
    color: #ffffff;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    text-align: right;
    white-space: nowrap;
    overflow: hidden;
    line-height: 1.2;
}

// ── Valor del NOMBRE ───────────────────────────────────────────────────────
// El label "Nombre:" ya está en el PNG — aquí va el valor real debajo
.cred-value-name {
    position: absolute;
    left: 0;
    top: 63.69%;
    width: 58%;
    font-size: 13px;
    font-weight: 800;
    color: #001b40;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
}

// ── Valor del GRADO/CURSO ──────────────────────────────────────────────────
.cred-value-grade {
    position: absolute;
    left: 0;
    top: 82.07%;
    width: 58%;
    font-size: 10.5px;
    font-weight: 800;
    color: #001b40;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
}

// ── Valor del AÑO LECTIVO ──────────────────────────────────────────────────
.cred-value-year {
    position: absolute;
    left: 0;
    top: 87.5%;
    width: 58%;
    font-size: 10px;
    font-weight: 600;
    color: #333333;
    line-height: 1.2;
    text-align: center;
}

// ── Foto rectangular (panel navy, parte superior derecha) ──────────────────
// Posición medida: left=61.65%, top=41.54%, width=27.99%, height=41.54%
.cred-photo-rect {
    position: absolute;
    left: 61.65%;
    top: 41.54%;
    width: 27.99%;
    height: 41.54%;
    overflow: hidden;
    // sin border-radius: el marco ya viene en el PNG

    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .cred-initials-rect {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        font-weight: 900;
        color: #7ec8e3;
        background: #1e3a5f;
    }
}

// ── QR ─────────────────────────────────────────────────────────────────────
// Anclado en esquina inferior derecha, máximo que cabe en el panel navy
.cred-qr-wrap {
    position: absolute;
    left: 60.47%;
    top: 37.73%;
    width: 37.21%;
    height: 58.61%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ffffff;

    ::ng-deep canvas,
    ::ng-deep img {
        display: block !important;
        width: 100% !important;
        height: 100% !important;
        max-width: unset !important;
        max-height: unset !important;
    }
}

// ══════════════════════════════════════════════════════════════════════════════
// IMPRESIÓN — 8.6cm × 5.4cm exactos
// ══════════════════════════════════════════════════════════════════════════════
@media print {
    body > * {
        display: none !important;
    }
    .cred-page {
        display: block !important;
    }
    .page-header,
    .search-panel,
    .person-info-bar,
    .preview-label,
    .token-info,
    .person-info-actions,
    p-toast,
    p-confirmDialog {
        display: none !important;
    }

    .cred-layout,
    .preview-panel,
    .credential-preview-wrap {
        all: unset;
        display: block !important;
    }

    .credential-card {
        width: 8.6cm !important;
        height: 5.4cm !important;
        border-radius: 0.15cm !important;
        box-shadow: none !important;
        page-break-inside: avoid;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        // color-adjust: exact !important;
    }

    // Ajustar tamaños de fuente para impresión real (escala ≈ 0.503x)
    .cred-value-name {
        font-size: 5.5px !important;
    }
    .cred-value-grade {
        font-size: 4.3px !important;
    }
    .cred-value-year {
        font-size: 4px !important;
    }
    .cred-institution {
        font-size: 4px !important;
    }

    @page {
        size: 8.6cm 5.4cm;
        margin: 0;
    }
}

// ── Responsive ────────────────────────────────────────────────────────────────
@media (max-width: 1024px) {
    .cred-layout {
        grid-template-columns: 280px 1fr;
    }
}
@media (max-width: 768px) {
    .cred-layout {
        grid-template-columns: 1fr;
    }
    .search-panel {
        position: static;
        max-height: 350px;
    }
}
