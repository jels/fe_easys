<!-- src/app/shared/components/staff/staff-form-dialog/staff-form-dialog.component.html -->
<p-dialog [header]="dialogTitle" [(visible)]="visible" [modal]="true" [draggable]="false" [resizable]="false"
    styleClass="staff-form-dialog" [style]="{ width: '860px', maxWidth: '95vw' }" [closeOnEscape]="true"
    (onHide)="close()">

    <ng-template pTemplate="header">
        <div class="dialog-header">
            <div class="dialog-header-icon">
                <i [class]="isEditMode() ? 'pi pi-pencil' : 'pi pi-user-plus'"></i>
            </div>
            <div>
                <h3 class="dialog-title">{{ dialogTitle }}</h3>
                <p class="dialog-subtitle">
                    {{ isEditMode() ? 'Actualice los datos del empleado' : 'Complete los datos para registrar un nuevo
                    empleado' }}
                </p>
            </div>
        </div>
    </ng-template>

    @if (loadingData()) {
    <div class="flex flex-col gap-3 p-4">
        @for (i of [1,2,3,4]; track i) { <p-skeleton height="3rem" /> }
    </div>
    } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <p-stepper [value]="activeStep()" (valueChange)="activeStep.set($event ?? 0)">
            <p-step-list>
                <p-step [value]="0"><i class="pi pi-user mr-1"></i> Datos Personales</p-step>
                <p-step [value]="1"><i class="pi pi-briefcase mr-1"></i> Datos Laborales</p-step>
                <p-step [value]="2"><i class="pi pi-dollar mr-1"></i> Contrato y Salario</p-step>
            </p-step-list>

            <p-step-panels>

                <!-- ── PASO 1: Datos Personales ──────────────────────── -->
                <p-step-panel [value]="0">
                    <ng-template #content let-activateCallback="activateCallback">
                        <div formGroupName="person" class="form-grid mt-3">
                            <div class="field">
                                <label>Nombres <span class="req">*</span></label>
                                <input pInputText formControlName="firstName" placeholder="Ej: María Fernanda"
                                    [class.ng-invalid]="isFieldInvalid('person.firstName')" />
                                @if (isFieldInvalid('person.firstName')) {
                                <small class="error-msg">El nombre es requerido</small>
                                }
                            </div>
                            <div class="field">
                                <label>Apellidos <span class="req">*</span></label>
                                <input pInputText formControlName="lastName" placeholder="Ej: Rodríguez Aquino"
                                    [class.ng-invalid]="isFieldInvalid('person.lastName')" />
                                @if (isFieldInvalid('person.lastName')) {
                                <small class="error-msg">El apellido es requerido</small>
                                }
                            </div>
                            <div class="field">
                                <label>Tipo Documento <span class="req">*</span></label>
                                <p-select formControlName="documentType" [options]="documentTypeOptions"
                                    optionLabel="label" optionValue="value" placeholder="Seleccionar" />
                            </div>
                            <div class="field">
                                <label>Nro. Documento <span class="req">*</span></label>
                                <input pInputText formControlName="documentNumber" placeholder="Ej: 3500000"
                                    [class.ng-invalid]="isFieldInvalid('person.documentNumber')" />
                                @if (isFieldInvalid('person.documentNumber')) {
                                <small class="error-msg">El documento es requerido</small>
                                }
                            </div>
                            <div class="field">
                                <label>Fecha de Nacimiento</label>
                                <p-datepicker formControlName="birthDate" dateFormat="dd/mm/yy" [showIcon]="true"
                                    placeholder="DD/MM/AAAA" />
                            </div>
                            <div class="field">
                                <label>Género</label>
                                <p-select formControlName="gender" [options]="genderOptions" optionLabel="label"
                                    optionValue="value" placeholder="Seleccionar" [showClear]="true" />
                            </div>
                            <div class="field">
                                <label>Celular</label>
                                <input pInputText formControlName="mobilePhone" placeholder="Ej: 0981-000000" />
                            </div>
                            <div class="field">
                                <label>Teléfono</label>
                                <input pInputText formControlName="phone" placeholder="Ej: 021-000000" />
                            </div>
                            <div class="field">
                                <label>Email</label>
                                <input pInputText formControlName="email" type="email" placeholder="correo@ejemplo.com"
                                    [class.ng-invalid]="isFieldInvalid('person.email')" />
                                @if (isFieldInvalid('person.email')) {
                                <small class="error-msg">Ingrese un email válido</small>
                                }
                            </div>
                            <div class="field">
                                <label>Ciudad</label>
                                <input pInputText formControlName="city" placeholder="Ej: Asunción" />
                            </div>
                            <div class="field col-span-2">
                                <label>Dirección</label>
                                <input pInputText formControlName="address" placeholder="Calle, número, barrio" />
                            </div>
                        </div>
                        <div class="step-footer">
                            <span></span>
                            <p-button label="Siguiente" icon="pi pi-arrow-right" iconPos="right"
                                (onClick)="activateCallback(1)" />
                        </div>
                    </ng-template>
                </p-step-panel>

                <!-- ── PASO 2: Datos Laborales ────────────────────────── -->
                <p-step-panel [value]="1">
                    <ng-template #content let-activateCallback="activateCallback">
                        <div class="form-grid mt-3">
                            <div class="field">
                                <label>Nº Legajo <span class="req">*</span></label>
                                <input pInputText formControlName="employeeNumber" placeholder="Ej: EMP-2024-001"
                                    [class.ng-invalid]="isFieldInvalid('employeeNumber')" />
                                @if (isFieldInvalid('employeeNumber')) {
                                <small class="error-msg">El legajo es requerido</small>
                                }
                            </div>
                            <div class="field">
                                <label>Tipo de Personal <span class="req">*</span></label>
                                <p-select formControlName="staffType" [options]="staffTypeOptions" optionLabel="label"
                                    optionValue="value" placeholder="Seleccionar" />
                            </div>
                            <div class="field">
                                <label>Cargo / Posición</label>
                                <input pInputText formControlName="position" placeholder="Ej: Docente de Matemáticas" />
                            </div>
                            <div class="field">
                                <label>Departamento</label>
                                <input pInputText formControlName="department" placeholder="Ej: Ciencias Exactas" />
                            </div>
                            @if (isTeacher) {
                            <div class="field col-span-2">
                                <label>Especialización</label>
                                <input pInputText formControlName="specialization"
                                    placeholder="Ej: Matemáticas y Física" />
                            </div>
                            }
                            <div class="field">
                                <label>Estado</label>
                                <p-select formControlName="status" [options]="statusOptions" optionLabel="label"
                                    optionValue="value" placeholder="Seleccionar" />
                            </div>
                            <div class="field">
                                <label>Fecha de Ingreso <span class="req">*</span></label>
                                <p-datepicker formControlName="hireDate" dateFormat="dd/mm/yy" [showIcon]="true"
                                    placeholder="DD/MM/AAAA" />
                            </div>
                        </div>
                        <div class="step-footer">
                            <p-button label="Anterior" icon="pi pi-arrow-left" severity="secondary"
                                (onClick)="activateCallback(0)" />
                            <p-button label="Siguiente" icon="pi pi-arrow-right" iconPos="right"
                                (onClick)="activateCallback(2)" />
                        </div>
                    </ng-template>
                </p-step-panel>

                <!-- ── PASO 3: Contrato y Salario ─────────────────────── -->
                <p-step-panel [value]="2">
                    <ng-template #content let-activateCallback="activateCallback">
                        <div class="form-grid mt-3">
                            <div class="field">
                                <label>Tipo de Contrato</label>
                                <p-select formControlName="contractType" [options]="contractTypeOptions"
                                    optionLabel="label" optionValue="value" placeholder="Seleccionar"
                                    [showClear]="true" />
                            </div>
                            <div class="field">
                                <label>Salario Mensual (PYG)</label>
                                <p-inputnumber formControlName="salary" [useGrouping]="true" mode="decimal"
                                    placeholder="Ej: 3500000" styleClass="w-full" />
                            </div>
                            <div class="field col-span-2">
                                <label>Horario de Trabajo</label>
                                <input pInputText formControlName="workSchedule"
                                    placeholder="Ej: Lunes a Viernes, 07:00 - 13:00" />
                            </div>
                            <div class="field col-span-2">
                                <label>Notas del Contrato</label>
                                <textarea pTextarea formControlName="contractNotes" rows="3"
                                    placeholder="Observaciones, condiciones especiales, etc."
                                    class="w-full resize-none">
                                    </textarea>
                            </div>
                        </div>
                        <div class="step-footer">
                            <p-button label="Anterior" icon="pi pi-arrow-left" severity="secondary"
                                (onClick)="activateCallback(1)" />
                            <p-button [label]="isEditMode() ? 'Actualizar' : 'Guardar'" icon="pi pi-save"
                                [loading]="loading()" (onClick)="onSubmit()" />
                        </div>
                    </ng-template>
                </p-step-panel>

            </p-step-panels>
        </p-stepper>
    </form>
    }
</p-dialog>