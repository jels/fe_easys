<!-- src/app/shared/components/parent/parent-form-dialog/parent-form-dialog.component.html -->
<p-dialog [header]="dialogTitle" [(visible)]="visible" [modal]="true" [draggable]="false" [resizable]="false"
    styleClass="parent-form-dialog" [style]="{ width: '780px', maxWidth: '95vw' }" [closeOnEscape]="true"
    (onHide)="close()">

    <ng-template pTemplate="header">
        <div class="dialog-header">
            <div class="dialog-header-icon">
                <i [class]="isEditMode() ? 'pi pi-pencil' : 'pi pi-user-plus'"></i>
            </div>
            <div>
                <h3 class="dialog-title">{{ dialogTitle }}</h3>
                <p class="dialog-subtitle">
                    {{ isEditMode() ? 'Actualice los datos del tutor' : 'Complete los datos para registrar un nuevo
                    tutor' }}
                </p>
            </div>
        </div>
    </ng-template>

    @if (loadingData()) {
    <div class="flex flex-col gap-3 p-4">
        @for (i of [1,2,3,4]; track i) { <p-skeleton height="3rem" /> }
    </div>
    } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-body">

        <!-- ── Sección: Datos Personales ──────────────────────────────── -->
        <div class="section-title">
            <i class="pi pi-user"></i>
            Datos Personales
        </div>

        <div formGroupName="person" class="form-grid">
            <div class="field">
                <label>Nombres <span class="req">*</span></label>
                <input pInputText formControlName="firstName" placeholder="Ej: Patricia"
                    [class.ng-invalid]="isFieldInvalid('person.firstName')" />
                @if (isFieldInvalid('person.firstName')) {
                <small class="error-msg">El nombre es requerido</small>
                }
            </div>

            <div class="field">
                <label>Apellidos <span class="req">*</span></label>
                <input pInputText formControlName="lastName" placeholder="Ej: López de Martínez"
                    [class.ng-invalid]="isFieldInvalid('person.lastName')" />
                @if (isFieldInvalid('person.lastName')) {
                <small class="error-msg">El apellido es requerido</small>
                }
            </div>

            <div class="field">
                <label>Tipo Documento <span class="req">*</span></label>
                <p-select formControlName="documentType" [options]="documentTypeOptions" optionLabel="label"
                    optionValue="value" placeholder="Seleccionar" />
            </div>

            <div class="field">
                <label>Nro. Documento <span class="req">*</span></label>
                <input pInputText formControlName="documentNumber" placeholder="Ej: 4001122"
                    [class.ng-invalid]="isFieldInvalid('person.documentNumber')" />
                @if (isFieldInvalid('person.documentNumber')) {
                <small class="error-msg">El documento es requerido</small>
                }
            </div>

            <div class="field">
                <label>Fecha de Nacimiento</label>
                <p-datepicker formControlName="birthDate" dateFormat="dd/mm/yy" [showIcon]="true"
                    placeholder="DD/MM/AAAA" />
            </div>

            <div class="field">
                <label>Género</label>
                <p-select formControlName="gender" [options]="genderOptions" optionLabel="label" optionValue="value"
                    placeholder="Seleccionar" [showClear]="true" />
            </div>

            <div class="field">
                <label>Celular</label>
                <input pInputText formControlName="mobilePhone" placeholder="Ej: 0981-000000" />
            </div>

            <div class="field">
                <label>Teléfono</label>
                <input pInputText formControlName="phone" placeholder="Ej: 021-000000" />
            </div>

            <div class="field">
                <label>Email</label>
                <input pInputText formControlName="email" type="email" placeholder="correo@ejemplo.com"
                    [class.ng-invalid]="isFieldInvalid('person.email')" />
                @if (isFieldInvalid('person.email')) {
                <small class="error-msg">Ingrese un email válido</small>
                }
            </div>

            <div class="field">
                <label>Ciudad</label>
                <input pInputText formControlName="city" placeholder="Ej: Asunción" />
            </div>

            <div class="field col-span-2">
                <label>Dirección</label>
                <input pInputText formControlName="address" placeholder="Calle, número, barrio" />
            </div>
        </div>

        <p-divider />

        <!-- ── Sección: Datos Laborales ───────────────────────────────── -->
        <div class="section-title">
            <i class="pi pi-briefcase"></i>
            Datos Laborales
        </div>

        <div class="form-grid">
            <div class="field">
                <label>Ocupación</label>
                <input pInputText formControlName="occupation" placeholder="Ej: Contador/a" />
            </div>

            <div class="field">
                <label>Lugar de Trabajo</label>
                <input pInputText formControlName="workplace" placeholder="Ej: Empresa SA" />
            </div>

            <div class="field">
                <label>Teléfono del Trabajo</label>
                <input pInputText formControlName="workPhone" placeholder="Ej: 021-300000" />
            </div>

            <div class="field field-switch">
                <label>Responsable Financiero</label>
                <div class="switch-row">
                    <p-toggleswitch formControlName="isFinancialResponsible" />
                    <span class="switch-hint">
                        {{ form.get('isFinancialResponsible')?.value ? 'Sí, es responsable de pagos' : 'No es
                        responsable de pagos' }}
                    </span>
                </div>
            </div>
        </div>
    </form>
    }

    <!-- Footer -->
    <ng-template pTemplate="footer">
        <div class="dialog-footer">
            <p-button label="Cancelar" icon="pi pi-times" severity="secondary" [text]="true" (onClick)="close()" />
            <p-button [label]="isEditMode() ? 'Actualizar' : 'Guardar'" icon="pi pi-save" [loading]="loading()"
                (onClick)="onSubmit()" />
        </div>
    </ng-template>
</p-dialog>